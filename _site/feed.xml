<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="en" /><updated>2023-02-26T20:19:59+01:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">NothingButCloud</title><subtitle>Hydejack is a boutique Jekyll theme for hackers, nerds, and academics, with a focus on personal sites that are meant to impress.
</subtitle><entry><title type="html">Ask me anything - Synchronization</title><link href="http://localhost:4000/2022-07-10-AMA_AADConnect/" rel="alternate" type="text/html" title="Ask me anything - Synchronization" /><published>2022-07-10T14:34:32+02:00</published><updated>2023-02-26T20:02:13+01:00</updated><id>http://localhost:4000/AMA_AADConnect</id><content type="html" xml:base="http://localhost:4000/2022-07-10-AMA_AADConnect/"><![CDATA[<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_I.png" style="width:75%" />
  <figcaption>Figure 1: AMA AAD Connect Teaser</figcaption>
</figure>

<ul id="markdown-toc">
  <li><a href="#deutsche-inhalte" id="markdown-toc-deutsche-inhalte">Deutsche Inhalte</a>    <ul>
      <li><a href="#configuration-setup" id="markdown-toc-configuration-setup">Configuration, Setup</a>        <ul>
          <li><a href="#wo-finde-ich-die-version-von-aadconnect-server" id="markdown-toc-wo-finde-ich-die-version-von-aadconnect-server">Wo finde ich die Version von AADConnect Server?</a></li>
          <li><a href="#welche-möglichkeiten-von-hochverfügbarkeit-und-lastenausgleich-gibt-es" id="markdown-toc-welche-möglichkeiten-von-hochverfügbarkeit-und-lastenausgleich-gibt-es">Welche Möglichkeiten von Hochverfügbarkeit und Lastenausgleich gibt es?</a></li>
          <li><a href="#wobei-kann-der-azure-ad-connect-documenter-helfen" id="markdown-toc-wobei-kann-der-azure-ad-connect-documenter-helfen">Wobei kann der Azure AD Connect Documenter helfen?</a></li>
          <li><a href="#welche-möglichkeiten-gibt-es-für-den-export-der-config" id="markdown-toc-welche-möglichkeiten-gibt-es-für-den-export-der-config">Welche Möglichkeiten gibt es für den Export der Config?</a></li>
          <li><a href="#was-bedeutet-es-wenn-aadc-im-azure-health-portal-unmonitored-ist" id="markdown-toc-was-bedeutet-es-wenn-aadc-im-azure-health-portal-unmonitored-ist">Was bedeutet es wenn AADC im Azure Health portal unmonitored ist?</a></li>
          <li><a href="#was-sind-denn-die-unterschiede-von-cloud-sync-zu-aad-connect-server-vorteilenachteile" id="markdown-toc-was-sind-denn-die-unterschiede-von-cloud-sync-zu-aad-connect-server-vorteilenachteile">Was sind denn die Unterschiede von Cloud Sync zu AAD Connect Server (Vorteile/Nachteile!)</a></li>
          <li><a href="#ist-migration-nach-cloud-sync-empfohlen-sinnvoll-oder-möglich" id="markdown-toc-ist-migration-nach-cloud-sync-empfohlen-sinnvoll-oder-möglich">Ist Migration nach Cloud Sync empfohlen, sinnvoll oder möglich?</a></li>
        </ul>
      </li>
      <li><a href="#operations" id="markdown-toc-operations">Operations:</a>        <ul>
          <li><a href="#wie-sieht-ein-health-check-aus" id="markdown-toc-wie-sieht-ein-health-check-aus">Wie sieht ein Health Check aus?</a></li>
          <li><a href="#-bei-cloud-sync" id="markdown-toc--bei-cloud-sync">… bei Cloud Sync</a></li>
          <li><a href="#-und-bei-aadc-server" id="markdown-toc--und-bei-aadc-server">… und bei AADC Server</a></li>
          <li><a href="#was-ist-zu-tun-wenn-localdb-zu-klein-oder-nicht-mehr-ausreichend-ist-10gb" id="markdown-toc-was-ist-zu-tun-wenn-localdb-zu-klein-oder-nicht-mehr-ausreichend-ist-10gb">Was ist zu tun wenn localDb zu klein oder nicht mehr ausreichend ist (10GB)?</a></li>
        </ul>
      </li>
      <li><a href="#was-gibt-es-beim-update-auf-v2-zu-beachten" id="markdown-toc-was-gibt-es-beim-update-auf-v2-zu-beachten">Was gibt es beim Update auf V2 zu beachten?</a></li>
    </ul>
  </li>
  <li><a href="#english-content-from-the-ama" id="markdown-toc-english-content-from-the-ama">English content from the AMA</a>    <ul>
      <li><a href="#configuration-setup-1" id="markdown-toc-configuration-setup-1">Configuration, Setup</a>        <ul>
          <li><a href="#where-can-i-find-the-version-of-aadconnect-server" id="markdown-toc-where-can-i-find-the-version-of-aadconnect-server">Where can I find the version of AADConnect Server?</a></li>
          <li><a href="#what-are-the-options-for-high-availability-and-load-balancing" id="markdown-toc-what-are-the-options-for-high-availability-and-load-balancing">What are the options for high availability and load balancing?</a></li>
          <li><a href="#what-the-azure-ad-connect-documenter-can-help-with" id="markdown-toc-what-the-azure-ad-connect-documenter-can-help-with">What the Azure AD Connect Documenter can help with?</a></li>
          <li><a href="#hat-are-the-options-for-exporting-the-config" id="markdown-toc-hat-are-the-options-for-exporting-the-config">hat are the options for exporting the Config?</a></li>
          <li><a href="#what-does-it-mean-when-aadc-is-unmonitored-in-azure-health-portal" id="markdown-toc-what-does-it-mean-when-aadc-is-unmonitored-in-azure-health-portal">What does it mean when AADC is unmonitored in Azure Health portal?</a></li>
          <li><a href="#what-are-the-differences-between-cloud-sync-and-aad-connect-server-advantagesdisadvantages" id="markdown-toc-what-are-the-differences-between-cloud-sync-and-aad-connect-server-advantagesdisadvantages">What are the differences between Cloud Sync and AAD Connect Server (advantages/disadvantages!)?</a></li>
          <li><a href="#is-migration-to-cloud-sync-recommended-useful-or-possible" id="markdown-toc-is-migration-to-cloud-sync-recommended-useful-or-possible">Is migration to Cloud Sync recommended, useful or possible?</a></li>
        </ul>
      </li>
      <li><a href="#operations-1" id="markdown-toc-operations-1">Operations:</a>        <ul>
          <li><a href="#what-does-a-health-check-look-like" id="markdown-toc-what-does-a-health-check-look-like">What does a Health Check look like?</a></li>
          <li><a href="#-for-cloud-sync" id="markdown-toc--for-cloud-sync">… for Cloud Sync</a></li>
          <li><a href="#-and-for-aadc-server" id="markdown-toc--and-for-aadc-server">… and for AADC Server</a></li>
          <li><a href="#what-to-do-if-localdb-is-too-small-or-insufficient-10gb" id="markdown-toc-what-to-do-if-localdb-is-too-small-or-insufficient-10gb">What to do if localDb is too small or insufficient (10GB)?</a></li>
        </ul>
      </li>
      <li><a href="#what-do-i-have-to-consider-when-updating-to-v2" id="markdown-toc-what-do-i-have-to-consider-when-updating-to-v2">What do I have to consider when updating to V2?</a></li>
    </ul>
  </li>
</ul>

<p>This was a German Session. but I have seen a couple of english speaking attandies in the audience, therefore you can also find the english content below.</p>

<p>Azure AMA zum Thema Synchronisation, zusammen mit Gregor Reimling vom Azure Metup Bonn. Das waren spannende Fragestellungen rund um den endenden Support von AAD Connect v1 und dem Update auf die Version 2 des Sync Boliden. Wir hatten aber noch weitere Themen, die ich ebenfalls sehr spannend fand. Eine Liste der Fragen und Antworten findet ihr in diesem Beitrag</p>

<p>Die Session wurde aufgezeichnet und ist auf <a href="https://www.youtube.com/watch?v=W2YGSMEvaKA&amp;t=1s" target="_blank">YouTube</a></p>

<p><strong>Hinweis</strong></p>

<p>Wenn in diesem Beitrag von AADC Server die Rede ist, ist immer die aktuelle Variante der Synchronisation, der On-Premises Bolide, gemeint. Wann immer Cloud Sync (Azure AD Cloud Sync) angesprochen wird, ist die neue Technologie der Synchronisation gemeint. Die macht mit Einschränkungen das Gleiche, arbeitet aber unter der Haube komplett anders. In den ersten Versionen (vor GA) wurde Cloud Sync mit Azure AD Cloud Provisioning betitelt.</p>

<h1 id="deutsche-inhalte">Deutsche Inhalte</h1>
<h2 id="configuration-setup">Configuration, Setup</h2>
<h3 id="wo-finde-ich-die-version-von-aadconnect-server">Wo finde ich die Version von AADConnect Server?</h3>
<p>Die Frage ist berechtigt, denn lange Zeit war die Version nur an wenigen Stellen und nicht wirklich intuitiv zu finden.</p>

<p>Ein Ort war (und ist) in “Apps &amp; features”, wie folgende Abbildung zeigt:</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_II.png" style="width:90%" />
  <figcaption>Figure 2: Die Version von AADC ist unter anderem in "Apps &amp; features" zu finden</figcaption>
</figure>

<p>Zwischenzeitlich hat Microsoft die Verion auch im “Synchronization Service Manager” integriert, wo sie meiner Meinung nach auch hingehört. Dort ist sie im Menü “Help” und dann “About …” zu finden</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_III.png" style="width:100%" />
  <figcaption>Figure 3: Version findet sich seit Neuestem auch im Sync Manager ...</figcaption>
</figure>

<p>… oder mittlerweile auch im AAD Portal</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_IV.png" style="width:100%" />
  <figcaption>Figure 4: ... oder im Azure AD Portal</figcaption>
</figure>

<p><strong>Hinweis</strong></p>

<p>Sollten die erforderlichen Berechtigungen fehlen, um den “Synchronization Manager” auszuführen, lässt sich die Version auch im Azure AD ermitteln. Und zwar im Bereich Connect Health, wie oben abgebildet. Sollte das aus irgendeinem Grund nicht gehen, weil zum Beispiel der Health Agent nicht registriert ist oder keine Infos liefert, bleibt immer noch “Apps &amp; features”.</p>

<p>Die Version ist bei AADC wichtig, da es häufiger Updates gibt und es von Bedeutung sein kann, zu wissen, was aktuell installiert ist. Umso verwirrender war es bislang, die Version nicht dort zu finden, wo sie intuitiv vermutet wird. Aber umso besser jetzt, dass MS dies nun an den richtigen Stellen integriert hat.</p>

<p>Solltest Du eine ältere Version von AADC einsetzen, und im AAD Connect Health Dashboard und auch im Synchronization Manager” nicht fündig werden, ist “Apps &amp; features” ebenfalls die beste Wahl für Dich, um die version herauszufinden</p>

<h3 id="welche-möglichkeiten-von-hochverfügbarkeit-und-lastenausgleich-gibt-es">Welche Möglichkeiten von Hochverfügbarkeit und Lastenausgleich gibt es?</h3>
<p>Cloud Sync bietet die Möglichkeit mehrere Agenten On-Premises auf Memberserver zu installieren. Diese Server bieten Hochverfügbarkeit, aber keinen Lastenausgleich. Mit anderen Worten: fällt ein Server aus, übernimmt ein anderer. Müssen x tausend Identitäten synchronisiert werden, geschieht dies durch einen Agenten (Server), ohne dass sich mehrere die Last teilen werden.</p>

<p>Diesen Lastenausgleich gibt es bei AADC nicht. Genauso gibt es keine “richtige” Möglichkeit der Hochverfügbarkeit. Einzig die Implementierueng eines oder mehrere sogenannter “Staging” Server ist eine Option, für ein Ausfallszenario vorzusorgen. Bei AADC ist immer ein Server der aktive Server. Das heisst, er schreibt (exportiert) Änderungen. Staging Server machen das Gleiche, jedoch exportieren sie nicht, auch machen sie keinen Password Hash Sync. In ihrer Datenbank ist aber der komplette Bestand an Identitäten enthalten. Fällt der aktive Servers aus, wird manuell aus dem Staging Server der aktive Server und ein kompletter Import aller zu synchronisierenden Objekte ist nicht notwendig, da diese Infos schon in der Datenbank liegen. Somit bedeutet dies eine Zeitersparnis, da quasi nur der Export aktiviert wird.
Das ist aber nicht wirklich Hochverfügbarkeit.</p>

<p>Das Thema ist spannend und herausfordernd. Da es einige Aspekte gibt, die hier unbedingt beachtet werden müssen. Zum Beispiel hat jeder AADC Server seine eigene Konfiguration, die mit den anderen AADC Servern nicht synchronisiert oder abgeglichen wird, wie das von einem Farm Setup bekannt ist, bei ADFS beispielsweise. Das birgt ein Risiko im Falle eines Wechsels von Staging zu aktivem Server, wenn der Staging Server ein anderes Setup als sein Pendant besitzt. Es gibt hier Maßnahmen und Tools wie dem zu begegnen ist. zum Teil ist dies hier beschrieben <a href="https://nothingbutcloud.net/2020-03-21-CP/#local-components" target="_blank">Local components in AADC</a></p>

<p>Die ganze Story beschreibt Microsoft in diesem <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-sync-staging-server" target="_blank">Docs Artikel</a></p>

<h3 id="wobei-kann-der-azure-ad-connect-documenter-helfen">Wobei kann der Azure AD Connect Documenter helfen?</h3>
<p>Der Azure AD Connect Documenter ist ein Tool, das nicht Teil des Setups ist und separat installiert werden muss. Die Installation auf einem AADC Server ist einfach und besteht nur aus einem simplen Copy der Dateien aus Github.
Danch wird für den Vergleich ein Dump der Konfiguration auf jedem der AADC Server erstellt, die es zu vergleichen gilt.</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ADSyncServerConfiguration</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"C:\ExportFolder"</span><span class="w">
</span></code></pre></div></div>

<p>Dieser Export jedes Servers, mit allen Unterverzeichnissen, muss sich auf dem Computer befinden, auf dem der Documenter ausgeführt wird. Der wertet diesen aus und erstellt einen HTML Report der farblich die Unterschiede sichtbar macht.</p>

<p>Die Dateien und die Dokumentation sind hier zu finden: <a href="https://github.com/Microsoft/AADConnectConfigDocumenter" target="_blank">Azure AD Connect Documenter</a></p>

<p>Erwähnenswert ist an dieser Stelle noch, das der “Documenter” dabei helfen kann “Sync Rules” von einem Server zu einem anderen zu transferieren. Der gesamte Vorgang ist zwar manuell, aber der Export mittels generiertem PS1 Script kann auf dem Zielserver ausgeführt werden, ohne das die Connector-ID anzupassen ist, wie das beispielsweise bei einem Transfer mittels Regeleditor der Fall ist. Hierfür ist in dem HTML-Report lediglich die Option “Only show changes” zu aktvieren. Danach erscheint die Möglichkeit “Download Sync Rule Changes Script”</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_V.png" style="width:100%" />
  <figcaption>Figure 5: AADC Documenter vergleicht den Export von zwei AADC Servern</figcaption>
</figure>

<h3 id="welche-möglichkeiten-gibt-es-für-den-export-der-config">Welche Möglichkeiten gibt es für den Export der Config?</h3>
<p>Ab Version 1.5.42.0 (July 2020) ist der Export der Konfiguration über den Setup Assistenten von AADC möglich</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VI.png" style="width:90%" />
  <figcaption>Figure 6: AADC Config manager erlaubt Export der Konfiguration für den Import auf einem weiteren Server</figcaption>
</figure>

<p>Beim Einsatz einer älteren Version, die den Export in der GUI des Config Managers nicht unterstützt, wie oben abgebildet, gibt es einen alternativen Weg für den Export. Details sind hier zu finden <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-import-export-config#migrate-settings-from-an-existing-server" target="_blank">“Migrate settings from an existing server”</a></p>

<p>Etwas umständlicher, aber der Weg führt hier über die Powershell genauso zum Ziel</p>

<p>Übrigens erstellt der AADC Config Wizard bei Änderungen ein JSON File mit der Konfiguration, die für den Import auf einem weiteren Server (z.B. als Staging) genutzt werden kann.</p>

<p>(Ordner: C:\ProgramData\AADConnect)</p>

<h3 id="was-bedeutet-es-wenn-aadc-im-azure-health-portal-unmonitored-ist">Was bedeutet es wenn AADC im Azure Health portal unmonitored ist?</h3>
<p>Ist ein AADC Server länger als 30 Tage inaktiv, wechselt sein Status im Dashboard von Azure AD Connect Health zu “unmonitored”, auch wenn der Server danach wieder gestartet wird, bleibt er “unmonitored”
Das lässt sich beheben, in dem der Health Agent neu installiert wird oder eine Neuregistrierung des Agent mit dem folgendem Cmdlet erfolgt:</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Register-AzureADConnectHealthSyncAgent</span><span class="w"> </span><span class="nt">-AttributeFiltering</span><span class="w"> </span><span class="bp">$true</span><span class="w"> </span><span class="nt">-StagingMode</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span></code></pre></div></div>

<h3 id="was-sind-denn-die-unterschiede-von-cloud-sync-zu-aad-connect-server-vorteilenachteile">Was sind denn die Unterschiede von Cloud Sync zu AAD Connect Server (Vorteile/Nachteile!)</h3>

<p>Azure AD Connect Cloud Sync ist die neuere (Public Preview Okt. 2019) Technology für die Synchronisation und vollständig in das Azure AD Portal integriert. Der Teil, der On-Premises installiert wird, ist gering und beschränkt sich auf einen schlanken Agent. Konfiguration, und alles was damit zusammenhängt, liegt im Azure AD. Der lokale Agent kommuniziert lediglich mit dem Forest und transferiert die Identitäten in Richtung Azure AD.</p>

<p>Im Gegenzug dazu ist AADC Server die seit langem etablierte, On-Premises Server basierte Technologie der Synchronisation. Sie entstammt ursprünglich dem Sync Client von MIIS (miisclient.exe) aus dem Jahre 2007 und ist eine für das Azure AD angepasstes Variante des Sync Client</p>

<p>Ich habe zwei Artikel um Thema Cloud Sync hier in meinem Blog, die auch auf die Unterschiede zwischen den beiden Technologien eingehen:</p>

<p><a href="https://nothingbutcloud.net/2020-03-21-CP/" target="_blank">“First experience with Azure AD Connect Cloud Provisioning”</a></p>

<p><a href="https://nothingbutcloud.net/2020-09-24-CP-Advanced/" target="_blank">“More Infos on Azure AD Connect Cloud Provisioning”</a></p>

<p>Ein entsprechender Microsoft Artikel, der auf die Unterschiede eingeht, ist hier zu finden:</p>

<p><a href="https://docs.microsoft.com/de-de/azure/active-directory/cloud-sync/what-is-cloud-sync#comparison-between-azure-ad-connect-and-cloud-sync" target="_blank">“Unterschiede zwischen Cloud Sync und AADC Server”</a></p>

<h3 id="ist-migration-nach-cloud-sync-empfohlen-sinnvoll-oder-möglich">Ist Migration nach Cloud Sync empfohlen, sinnvoll oder möglich?</h3>
<p>Beide Technlogien sind von der Architektur her verschieden und bislang ist mir kein Migrationspfad bekannt. Warum auch? Eine intakte AADC Server Implementierung durch eine Cloud Sync Implementierung zu ersetzen macht aktuell keinen Sinn, da AADC Server derzeit noch einen größeren Funktionsumfang besitzt. Die Frage stellt sich somit aktuell nicht. Aber ich bin ziemlich sicher, dass irgendwann, wenn die Funktionen in Cloud Sync zunehmen und ein Einsatz dieser Technologie attraktiver wird, eine Migration von nutzen sein kann und Microsoft einen Migrationspfad beschreiben wird.</p>

<h2 id="operations">Operations:</h2>
<h3 id="wie-sieht-ein-health-check-aus">Wie sieht ein Health Check aus?</h3>

<h3 id="-bei-cloud-sync">… bei Cloud Sync</h3>

<p>Bei Cloud Sync gibt es mehrere Möglichkeiten, dem Service auf dem Zahn zu fühlen. Ein guter und erster Start für einen Check ist das Cloud Sync Dashboard sowohl beim Service aber auch bei den jeweiligen Agenten, die hier aufgelistet sind:</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VII.png" style="width:100%" />
  <figcaption>Figure 7: "Healthy" als Service Status sieht gut aus</figcaption>
</figure>

<p>Die Option “Logs” in der Auswahl oben bezieht sich übrigens auf die Protokolle der Synchronisation. Hier ist nicht der Status zu den Agenten oder Ähnliches zu finden</p>

<p>Auch wenn Cloud Sync den Schwerpunkt der Administration in Azure hat, so gibt es doch auf den Servern mit installiertem Agent die Möglichkeit den Status zu prüfen und auch gezielt nach Fehlern zu suchen. Meiner Meinung nach aber als eine Option, wenn die Aussagekraft der Fehler in Azure AD nicht schlüssig ist, quasi als nächsten Schritt in der Fehlersuche.</p>

<p>Das Eventlog ist immer eine gute Quelle um auf einem Server nach dem Rechten zu sehen, so auch bei Cloud Sync. Mit dem Agentsetup werden zwei Protokolle mit installiert, <strong>AgentUpdater</strong> und <strong>ProvisioningAgent</strong> Ersteres dient dem Update, wie der Name auch andeutet, interesseanter ist da schon das Log des Provioning Agenten, das zeigt ob alles rund läuft oder eben nicht.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VIII.png" style="width:100%" />
  <figcaption>Figure 8: "Das Log des Provioning Agenten gibt Aufschluss ob alles richtig tickt</figcaption>
</figure>

<p>Im Übrigen sind das “Application Log” und auch das “System Log” gleichfalls Orte, die der Agent für die Ablage von Informationen verwendet. Es bietet sich also an sämtliche Logs zu betrachten.</p>

<p>Dann wäre da natürlich noch die Powershell. Mit dem Setup des Agenten wird alles erforderlich bereitgestellt. Mit einigen wenigen Cmdlets ist das Module am Start und bietet somit die Möglichkeit von der Kommandozeile aus aktiv zu werden, wie die nächste Abbildung zeigt:</p>
<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_IX.png" style="width:100%" />
  <figcaption>Figure 9: "Das mit installierte Powershell Module für Cloud Sync</figcaption>
</figure>

<p>Für eine noch detailliertere Analyse bieten sich die Trace Logs an. Hier sind übrigens auch die Eventlogs (EVTX files) zu finden, die mit folgendem Cmdlet aus dem Cloud Sync Module generiert werden:</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Export-AADCloudSyncToolsLogs</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_X.png" style="width:100%" />
  <figcaption>Figure 10: Die Tracelogs bieten einen noch tieferen Einblick in die Arbeitsweise des Cloud Sync Agenten</figcaption>
</figure>

<h3 id="-und-bei-aadc-server">… und bei AADC Server</h3>

<p>Bei Azure AD Connect Server gibt es mehr Möglichkeiten für einen Health Check, verglichen zu Cloud Sync. Für einen ersten Blick, und um zu prüfen, ob alles passt, macht es Sinn im Azure AD Portal zu starten. Hier wird ein umfassender Status angezeigt und das Health Dashboard ist zu finden im Portal des Azure AD in der Navigation unter <strong>Azure AD Connect</strong> und dann im Bereich von Azure AD Connect über die Auswahl <strong>HEALTH AND ANALYTICS</strong></p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XI.png" style="width:100%" />
  <figcaption>Figure 11: Health Dashboard zeigt den Gesamtstatus von Azure AD Connect Server</figcaption>
</figure>

<p>Da es auch einen Health Agenten für ADFS und einen für die AD Domain Services gibt, lässt sich hier alles gesammelt betrachten, natürlich nur wenn die lokalen Systeme mit dem jeweiligen Agenten ausgestattet sind. Alle Infos zu AADC befinden sich hinter den entsprechenden Quick start links (siehe roter Rahmen in Abbildung 11)</p>

<p>Das Dashboard hier besteht aus einer Vielzahl aktiver Elemente, die per Quicklink zwischen den Bereichen wechselt, andere Einsichten liefert und eine detaillierte Analyse der Health Infos gestattet. Wie am Beispiel der beiden Sever unten bei Auswahl eines der jeweiligen Serverobjekte.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XII.png" style="width:100%" />
  <figcaption>Figure 12: So soll es aussehen: alles gesund meldet der health Agent von den On-prem AADC Servern</figcaption>
</figure>

<p>Sollte das Azure AD und die Health Dashboards keinen Hinweis zu einer Fehlersituation liefern, besteht auch bei den Azure AD Connect Servern die Möglichkeit das Eventlog zu untersuchen. Das Augenmerk sollte hier auf dem “Application Log” liegen, hier listet der Sync Service akkribisch was Sache ist.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XIII.png" style="width:100%" />
  <figcaption>Figure 13: Application Event Log liefert detaillierte Infos zum Zustand der Synchronisation</figcaption>
</figure>

<p>Die Powershell bietet perfekte Möglichkeiten um auf einem AADC Server nach dem Rechten zu sehen. Das mächtige PS-Module “adsync” (117 cmdlets) liefert viele Möglichkeiten hierzu. Genauso hilfreich ist das Modul “ADSyncDagnostics” mit dem Cmdlet</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Invoke-ADSyncDiagnostics</span><span class="w">
</span></code></pre></div></div>

<p>wie Abbildung 14 zeigt.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XIV.png" style="width:100%" />
  <figcaption>Figure 14: Powershell eignet sich perfekt für Health Check und Analyse. Hier das Cmdlet "Invoke-ADSyncDiagnostics"</figcaption>
</figure>

<h3 id="was-ist-zu-tun-wenn-localdb-zu-klein-oder-nicht-mehr-ausreichend-ist-10gb">Was ist zu tun wenn localDb zu klein oder nicht mehr ausreichend ist (10GB)?</h3>
<p>Beim Setup von Azure AD Connect wird, wenn im Wizard nicht anders angegeben, ein Local DB installiert. Dies ist praktisch und einfach. Local DB ist aber auf eine maximale DB Größe von 10GB beschränkt, was sich viel anhört, aber unter Umständen schnell erreicht ist. Es lässt sich pauschal nicht beziffern, das bei x Usern im Sync die 10GB bei dieser oder jener Anzahl erreicht ist. Das hängt von mehreren Faktoren ab. Aber der wichtigste Faktor ist <strong>wieviele Connectoren (AD Forests) sind Teil der Synchronisation?</strong></p>

<p>In der Gesamt DB ist schließlich alles enthalten: Metaverse (sämtliche Objekte). Genauso die Objekte der jeweiligen Connectoren, quasi als “Rohdaten Import” für den Abgleich mit der Metaverse.</p>

<p>Um es für die Frage hier auf den Punkt zu bringen, habe ich zuletzt ein AADC Setup mit einer AD Domain gesehen. Hier wurden ca. 500 Gruppen synchronisiert. Keine Computerobjekte. Und es waren um die 30.000 Benutzer vorhanden als die DB Größe die Grenze von 10GB erreichte.</p>

<p>Microsoft beschreibt in <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-install-move-db" target="_blank">diesem Artikel</a> und auch <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-install-existing-database" target="_blank">hier</a> die einzelnen Schritte, die beim Verschieben der Datenbank, bzw. beim Wiederverwenden einer vorhandenenen DB, zu tun sind.</p>

<p>Um es hier zusammenfassend auf den Ounkt zu bringen:</p>

<ul>
  <li>
    <p>DB (MDF- und LDF- Dateien) auf dem aktuellen Sync Server dem Dateisystem an einen sicheren Ort kopieren bzw. direkt auf den dedizierten, entfernten SQL Server.</p>
  </li>
  <li>
    <p>DB dort einbinden</p>
  </li>
  <li>
    <p>AADC neu installieren, und wie in den Beitrag aus den Links oben beschrieben, das Setup mit dem Switch <strong>/useexistingdatabase</strong> aufrufen. Im Setup-Wizard besteht dadurch die Option einen SQL Server anzugeben. Im Weiteren wird die dort befindliche DB erkannt und verwendet.</p>
  </li>
  <li>
    <p>Bitte unbedingt die Post-Tasks aus den MS Beiträgen beachten!</p>
  </li>
</ul>

<h2 id="was-gibt-es-beim-update-auf-v2-zu-beachten">Was gibt es beim Update auf V2 zu beachten?</h2>
<p>Aus meiner Sicht ist die Aktualisierung auf die v2 unkritisch und kein Problem! Ich habe schon in-place Updates gemacht, würde aber strategisch gesehen einen anderen Weg gehen, wie weiter unten beschrieben. Zunächst einmal einige Eckpunkte rund um das Thema AADC Update auf v2</p>

<ul>
  <li>
    <p>v2 enthält keinerlei gravierende Änderungen an den Funktionalitäten und Features. Lediglich die Serverkomponenten wurden an die aktuellen Server Versionen angepasst: Windows Server 2016 und SQL 2019. Eine Gesamtliste der Anforderungen befindet sich hier <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/reference-connect-version-history#2030" target="_blank">Functional changes in 2.0.3.0</a></p>
  </li>
  <li>
    <p>Auch wenn automatisches Update “Set-ADSyncAutoUpgrade -AutoUpgradeState enabled”  eingeschaltet ist, greift das Setting hier nicht. Die Aktualisierung auf v2 ist ein manueller Schritt, der nicht automatisiert ausgeführt wird</p>
  </li>
  <li>
    <p>Eine von einem v1 AADC Server erstellter Export der Config kann auf einem neuen v2 Server importiert werden. Die JSON Files sind kompatibel</p>
  </li>
  <li>
    <p>Wie oben erwähnt ist ein In-Place Update unterstützt. Da hier aber Altlasten auf dem Server zurückbleiben (SQL Server Komponenten) würd ich zu einer neuen Installation raten. Alte SQL Server Überbleibsel lassen sich zwar manuell entfernen, aber eine neue Version macht hier aus meiner Sicht Sinn.</p>
  </li>
</ul>

<p>Wie bereits erwähnt unterstützt das Setup ein In-Place Update. ich würde aber folgende Schritte ausführen um einen Server auf v2 zu aktualisieren:</p>

<ol>
  <li>Von aktuellem AADC Server die Config exportieren (AADC Config Wizard)</li>
  <li>Aktiven AADC Server zum Staging machen</li>
  <li>Neuen Server (neuer Computername) bereitstellen.</li>
  <li>TLS 1.2 aktivieren, wenn noch nicht geschehen. Sonst droht eine Fehlermeldung beim Setup von AADC
<a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/reference-connect-tls-enforcement#enable-tls-12" target="_blank">Erzwingen von TLS 1.2 für AADC</a></li>
  <li>Installieren von AADC mit v2 und Import der JSON Config von anderem AADC Server (Punkt #1)</li>
  <li>Server ist Staging. Health Check, ob alles passt. AD Health Dashboard, Eventlog, Synchronization Service Manager Console. Im Regeleditor prüfen ob die Regeln vorhanden sind</li>
  <li>Ändern von Testdaten On-Premises (Benutzer Telefonnummer, neuen Benutzer anlegen etc.) und manuelle Synchronisation starten. Cmdlet: “Start-ADSyncSyncCycle”
Werden Änderungen verarbeitet? Prüfen von Pending Exports für den Azure AD Connector Space. Der Server ist Staging. Er wird nichts Richtung Azure AD schreiben</li>
  <li>Wenn alles ok ist, den neuen Server aktivieren (AADC Config Wizard)</li>
  <li>Geht bei den Punkten oben irgendetwas schief, kann der zuvor zum Staging Server ausgemusterte Sync Server wieder in Betrieb genommen werden und es besteht Zeit in Ruhe das Problem zu untersuchen.</li>
  <li>Ist bis hierhin alles in Ordnung (wovon auszugehen ist), sind jetzt der Reihe nach die vorhandenen Staging Server zu aktualisieren. Auch hier gilt wieder, entweder In-Place oder mit einer komplett neuen Maschine</li>
</ol>

<h1 id="english-content-from-the-ama">English content from the AMA</h1>

<p>Azure AMA (Ask me anything) on the topic of synchronization, together with Gregor Reimling from Azure Metup Bonn. These were exciting questions around the ending support of AAD Connect v1 and the update to version 2 of the Sync Bolide. However, we had other topics that I also found very exciting. You can find a list of the questions and answers in this post</p>

<p>The session was recorded and is available on <a href="https://www.youtube.com/watch?v=W2YGSMEvaKA&amp;t=1s" target="_blank">YouTube</a></p>

<h2 id="configuration-setup-1">Configuration, Setup</h2>
<h3 id="where-can-i-find-the-version-of-aadconnect-server">Where can I find the version of AADConnect Server?</h3>
<p>The question is justified, because for a long time the version could only be found in a few places and not really intuitively.</p>

<p>One place was (and is) in “Apps &amp; features”, as the following figure shows:</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_II.png" style="width:90%" />
  <figcaption>Figure 2: The version of AADC can be found in "Apps &amp; features" among others</figcaption>
</figure>

<p>In the meantime, Microsoft has also integrated the Verion in the “Synchronization Service Manager”, where I think this is the perfect place. There it can be found in the menu “Help” and then “About …”</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_III.png" style="width:100%" />
  <figcaption>Figure 3: version can now also be found in the Sync Manager ...</figcaption>
</figure>

<p>… or meanwhile also in the AAD Portal</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_IV.png" style="width:100%" />
  <figcaption>Figure 4: ... or in the Azure AD Portal</figcaption>
</figure>

<p><strong>Note</strong></p>

<p>If the required permissions to run the “Synchronization Manager” are missing, the version can also be determined in Azure AD. This is done in the Connect Health area, as shown above. If for some reason this does not work, for example because the Health Agent is not registered or does not provide any info, there is still “Apps &amp; features” the location to check the version</p>

<p>The version is important with AADC because updates are more frequent and it can be significant to know what is currently installed. So it was all the more confusing not to find the version where it is intuitively assumed. But all the better now that MS has integrated this in the right places.</p>

<p>If you are using an older version of AADC and can’t find it in the AAD Connect Health Dashboard and also in the Synchronization Manager, Apps &amp; features is also the best choice for you to find out the version.</p>

<h3 id="what-are-the-options-for-high-availability-and-load-balancing">What are the options for high availability and load balancing?</h3>
<p>Cloud Sync provides the ability to install multiple agents on-premises on member servers. These servers provide high availability, but no load balancing. In other words, if one server fails, another one takes over. If x thousand identities need to be synchronized, this is done by one agent (server) without to share the load between them.</p>

<p>This load balancing does not exist in AADC. In the same way there is no “real” possibility of high availability. Only the implementation of one or more so-called “staging” servers is an option to provide for a failure scenario. With AADC one server is always the active server. This box writes changes (exports). Staging servers do the same, but they do not run an export, nor do they do password hash sync. However, their database contains the complete set of identities. If the active server fails, the staging server manually becomes the active server and a complete import of all objects to be synchronized is not necessary, because this info is already in the database. Thus this means a time saving, since quasi only the export is activated.
But this is not really high availability.</p>

<p>The topic is exciting and challenging. As there are some aspects that have to be taken into account. For example, each AADC server has its own configuration, which is not synchronized or aligned with the other AADC servers, as is known from a farm setup, with ADFS for example. This poses a risk in case of a change from staging to active server, if the staging server has a different setup than its counterpart. There are measures and tools to counter this, some of which are described here. <a href="https://nothingbutcloud.net/2020-03-21-CP/#local-components" target="_blank">Local components in AADC</a></p>

<p>Microsoft describes the whole story in this <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-sync-staging-server" target="_blank">Docs Artikel</a></p>

<h3 id="what-the-azure-ad-connect-documenter-can-help-with">What the Azure AD Connect Documenter can help with?</h3>
<p>Azure AD Connect Documenter is a tool that is not part of the built-in tools and it must be installed separately. The installation on an AADC server is simple and only consists of a simple copy of the files from Github.
Then a dump of the configuration on each of the AADC servers is created for comparison by the Documenter.</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get-ADSyncServerConfiguration</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"C:\ExportFolder"</span><span class="w">
</span></code></pre></div></div>

<p>This dump from each server, with all subdirectories, must be on the computer on which the Documenter is executed. The Documenter evaluates this and creates a HTML report that shows the differences in color.</p>

<p>The files and the documentation can be found here: <a href="https://github.com/Microsoft/AADConnectConfigDocumenter" target="_blank">Azure AD Connect Documenter</a></p>

<p>It is worth mentioning here that the “Documenter” can help to transfer “Sync Rules” from one server to another. The whole process is manual, but the export using the generated PS1 script can be executed on the target server without having to adjust the connector ID, as is the case with a transfer using the rule editor, for example. To do this, simply activate the option “Only show changes” in the HTML report. After that the option “Download Sync Rule Changes Script” appears.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_V.png" style="width:100%" />
  <figcaption>Figure 5: AADC Documenter compares the export from two AADC servers</figcaption>
</figure>

<h3 id="hat-are-the-options-for-exporting-the-config">hat are the options for exporting the Config?</h3>
<p>As of version 1.5.42.0 (July 2020) the export of the configuration is possible via the setup wizard of AADC</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VI.png" style="width:90%" />
  <figcaption>Figure 6: AADC Config manager allows export of configuration for later import on another server</figcaption>
</figure>

<p>When using an older version that does not support export in the Config Manager GUI, as shown above, there is an alternative way to export. Details can be found here <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-import-export-config#migrate-settings-from-an-existing-server" target="_blank">“Migrate settings from an existing server”</a></p>

<p>A bit more cumbersome, but the way leads here via the Powershell just as to the goal</p>

<p>By the way, the AADC Config Wizard creates a JSON file with the configuration when changes are made, which can be used for import on another server (e.g. as staging).
(Ordner: C:\ProgramData\AADConnect)</p>

<h3 id="what-does-it-mean-when-aadc-is-unmonitored-in-azure-health-portal">What does it mean when AADC is unmonitored in Azure Health portal?</h3>
<p>If an AADC server is inactive for more than 30 days, its status in the Azure AD Connect Health dashboard changes to “unmonitored”, even if the server is restarted afterwards, it remains “unmonitored”.
This can be fixed by reinstalling the Health Agent or re-registering the agent with the following cmdlet:</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Register-AzureADConnectHealthSyncAgent</span><span class="w"> </span><span class="nt">-AttributeFiltering</span><span class="w"> </span><span class="bp">$true</span><span class="w"> </span><span class="nt">-StagingMode</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span></code></pre></div></div>

<h3 id="what-are-the-differences-between-cloud-sync-and-aad-connect-server-advantagesdisadvantages">What are the differences between Cloud Sync and AAD Connect Server (advantages/disadvantages!)?</h3>

<p>Azure AD Connect Cloud Sync is the newer (Public Preview Oct. 2019) technology for synchronization and fully integrated with Azure AD Portal. The part that is installed on-premises is minor and limited to a lean agent. Configuration, and everything related to it, resides in Azure AD. The on-premises agent only communicates with the forest and transfers identities towards Azure AD.</p>

<p>In contrast, AADC Server is the long-established on-premises server-based technology of synchronization. It originates from the Sync Client of MIIS (miisclient.exe) from 2007 and is a variant of the Sync Client adapted for Azure AD.</p>

<p>I have two articles around Cloud Sync here on my blog that also discuss the differences between the two technologies:</p>

<p><a href="https://nothingbutcloud.net/2020-03-21-CP/" target="_blank">“First experience with Azure AD Connect Cloud Provisioning”</a></p>

<p><a href="https://nothingbutcloud.net/2020-09-24-CP-Advanced/" target="_blank">“More Infos on Azure AD Connect Cloud Provisioning”</a></p>

<p>A corresponding Microsoft article that goes into detail about the differences can be found here:</p>

<p><a href="https://docs.microsoft.com/de-de/azure/active-directory/cloud-sync/what-is-cloud-sync#comparison-between-azure-ad-connect-and-cloud-sync" target="_blank">“Differences between Cloud Sync and AADC Server”</a></p>

<h3 id="is-migration-to-cloud-sync-recommended-useful-or-possible">Is migration to Cloud Sync recommended, useful or possible?</h3>
<p>Both technologies are different in terms of architecture and so far I am not aware of a migration path. And why? Replacing an intact AADC Server implementation with a Cloud Sync implementation does not currently make sense, since AADC Server currently still has a larger range of functions. So the question does not arise at the moment. But I am quite sure that at some point, when the features in Cloud Sync increase and the use of this technology becomes more attractive, a migration may be useful and Microsoft will describe a migration path.</p>

<h2 id="operations-1">Operations:</h2>
<h3 id="what-does-a-health-check-look-like">What does a Health Check look like?</h3>

<h3 id="-for-cloud-sync">… for Cloud Sync</h3>

<p>With Cloud Sync there are several ways to check the service. A good and first start for a check is the Cloud Sync Dashboard, both for the service but also for the respective agents, which are listed here:</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VII.png" style="width:100%" />
  <figcaption>Figure 7: "Healthy" as service status looks good</figcaption>
</figure>

<p>By the way, the option “Logs” in the selection above refers to the logs of the synchronization. Here is not the status to the agents to be found</p>

<p>Even if Cloud Sync has the main focus of administration in Azure, there is still the possibility to check the status on the servers with an installed agent and also to search specifically for errors. In my opinion, however, as an option if the meaningfulness of the errors in Azure AD is not conclusive, virtually as the next step in troubleshooting.</p>

<p>The event log is always a good source to check on a server, and Cloud Sync is no exception. With the agent setup, two logs are installed, <strong>AgentUpdater</strong> and <strong>ProvisioningAgent</strong>. The former is used for updates, as the name suggests, but the log of the provisioning agent is more interesting, as it shows whether everything is running smoothly or not.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_VIII.png" style="width:100%" />
  <figcaption>Figure 8: The log of the Provioning Agent provides information if everything is ticking correctly</figcaption>
</figure>

<p>By the way, the “Application Log” and the “System Log” are also places that the agent uses to store information. It is therefore a good idea to look at all logs.</p>

<p>Then, of course, there is the Powershell. With the setup of the agent everything necessary is provided. With a few cmdlets the module is up and running and offers the possibility to be active from the command line, as the next figure shows:</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_IX.png" style="width:100%" />
  <figcaption>Figure 9: The installed Powershell module for Cloud Sync</figcaption>
</figure>

<p>The trace logs can be used for an even more detailed analysis. Here you can also find the event logs (EVTX files), which are generated with the following cmdlet from the Cloud Sync Module:</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Export-AADCloudSyncToolsLogs</span><span class="w">
</span></code></pre></div></div>
<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_X.png" style="width:100%" />
  <figcaption>Figure 10: The tracelogs provide an even deeper insight into how the Cloud Sync agent works</figcaption>
</figure>

<h3 id="-and-for-aadc-server">… and for AADC Server</h3>

<p>With Azure AD Connect Server there are more options for a health check compared to Cloud Sync. For a first look, and to check if everything fits, it makes sense to start in the Azure AD portal. Here a comprehensive status is displayed and the health dashboard can be found in the Azure AD portal in the navigation under <strong>Azure AD Connect</strong> and then in the area of Azure AD Connect via the selection <strong>HEALTH AND ANALYTICS</strong>.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XI.png" style="width:100%" />
  <figcaption>Figure 11: Health Dashboard shows the overall status of Azure AD Connect Server</figcaption>
</figure>

<p>Since there is also a Health Agent for ADFS and one for the AD Domain Services, everything can be viewed collectively here, of course only if the local systems are equipped with the respective agent. All information about AADC can be found behind the corresponding Quick start on the left (see red frame in Figure 11).</p>

<p>The dashboard here consists of a multitude of active elements, which switch between the areas via quicklink, provide other insights and allow a detailed analysis of the health info. As in the example of the two servers below, by selecting one of the respective server objects.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XII.png" style="width:100%" />
  <figcaption>Figure 12: This is how it should look: everything healthy is reported by the health agent from the on-prem AADC servers</figcaption>
</figure>

<p>If Azure AD and the health dashboards do not provide any information about an error situation, it is also possible to examine the event log of the Azure AD Connect servers. The focus here should be on the “Application Log”, where the Sync Service meticulously lists what is going on.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XIII.png" style="width:100%" />
  <figcaption>Figure 13: Application Event Log provides detailed info about the state of synchronization</figcaption>
</figure>

<p>The Powershell offers perfect possibilities to check on an AADC server. The powerful PS module “adsync” (117 cmdlets) provides many possibilities for this. Equally helpful is the module “ADSyncDagnostics” with the cmdlet</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Invoke-ADSyncDiagnostics</span><span class="w">
</span></code></pre></div></div>

<p>as Figure 14 shows.</p>

<figure>
  <img src="/MyPics/2022-07-12-AMA_AADConnect_XIV.png" style="width:100%" />
  <figcaption>Figure 14: Powershell is perfect for health check and analysis. Here is the "Invoke-ADSyncDiagnostics cmdlet"</figcaption>
</figure>

<h3 id="what-to-do-if-localdb-is-too-small-or-insufficient-10gb">What to do if localDb is too small or insufficient (10GB)?</h3>
<p>During Azure AD Connect setup, a Local DB is installed unless otherwise specified in the wizard. This is convenient and simple. However, Local DB is limited to a maximum DB size of 10GB, which sounds like a lot, but may be reached quickly. It is not possible to say that with x users in sync the 10GB is reached with this or that number of GB. That depends on several factors. But the most important factor is <strong>how many Connectors (AD Forests) are part of the synchronization?</strong></p>

<p>Everything is contained in the total DB: Metaverse (all objects). As well as the objects of the respective connectors, quasi as “raw data import” for the comparison with the Metaverse.</p>

<p>To get to the point for the question here, I recently saw an AADC setup with an AD domain. Here, about 500 groups were synchronized. No computer objects. And there were around 30,000 users when the DB size reached the 10GB limit.</p>

<p>Microsoft describes in <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-install-move-db" target="_blank">this docs article</a> and also <a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/how-to-connect-install-existing-database" target="_blank">here</a> the individual steps to be taken when moving the database or reusing an existing DB.</p>

<p>To summarize it here to the point:</p>

<ul>
  <li>
    <p>Copy DB (MDF and LDF files) on the current sync server to the file system in a safe place or directly to the dedicated remote SQL server.</p>
  </li>
  <li>
    <p>Mount DB there</p>
  </li>
  <li>
    <p>Reinstall AADC, and as described in the post from the links above, call the setup with the switch <strong>/useexistingdatabase</strong>. In the setup wizard you have the option to specify a SQL server. Afterwards the DB located there will be recognized and used.</p>
  </li>
  <li>
    <p>Please pay attention to the post-tasks from the MS articles!</p>
  </li>
</ul>

<h2 id="what-do-i-have-to-consider-when-updating-to-v2">What do I have to consider when updating to V2?</h2>
<p>From my point of view the update to v2 is uncritical and no problem! I have done in-place updates, but would strategically go a different route as described below. First of all, some key points around the topic of AADC update to v2</p>

<ul>
  <li>
    <p>v2 does not contain any serious changes to functionality and features. Only the server components have been adapted to the current server versions: Windows Server 2016 and SQL 2019. An overall list of requirements can be found here. <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/reference-connect-version-history#2030" target="_blank">Functional changes in 2.0.3.0</a></p>
  </li>
  <li>
    <p>Even if automatic update “Set-ADSyncAutoUpgrade -AutoUpgradeState enabled” is enabled, the setting does not take effect here. The upgrade to v2 is a manual step that is not automated</p>
  </li>
  <li>
    <p>A config export created by a v1 AADC server can be imported on a new v2 server. The JSON files are compatible</p>
  </li>
  <li>
    <p>As mentioned above, an in-place update is supported. However, since there is legacy on the server (SQL Server components) I would advise a new installation. Old SQL Server leftovers can be removed manually, but a new version makes sense from my point of view.</p>
  </li>
</ul>

<p>As mentioned before the setup supports an in-place update. but I would recommend the following steps to update a server to v2:</p>

<ol>
  <li>export config from current AADC server (AADC Config Wizard).</li>
  <li>make active AADC server staging</li>
  <li>deploy new server (new computer name).</li>
  <li>activate TLS 1.2, if not already done. Otherwise there is a risk of an error message during the setup of AADC.
<a href="https://docs.microsoft.com/de-de/azure/active-directory/hybrid/reference-connect-tls-enforcement#enable-tls-12" target="_blank">Enforce TLS 1.2 for AADC</a></li>
  <li>install AADC with v2 and import JSON config from other AADC server (point #1).</li>
  <li>server is staging. Health Check if everything fits. AD Health Dashboard, Eventlog, Synchronization Service Manager Console. In the rule editor check if the rules are present.</li>
  <li>change test data on-premises (user phone number, create new user etc.) and start manual synchronization. Cmdlet: “Start-ADSyncSyncCycle”.
Are changes processed? Checking pending exports for Azure AD Connector space. The server is staging. It will not write anything towards Azure AD</li>
  <li>if everything is ok, enable the new server (AADC Config Wizard).</li>
  <li>if something goes wrong with the points above, the sync server that was previously retired to staging can be brought back online and there is time to investigate the issue at your leisure.
If everything is in order up to this point (which is to be assumed), the existing staging servers must now be updated one after the other. Again, either in-place or with a completely new machine.</li>
</ol>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2022-07-10-AMA_AADConnect/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2022-07-10-AMA_AADConnect/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2022-07-10-AMA_AADConnect/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[Figure 1: AMA AAD Connect Teaser]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2022-07-12-AMA_AADConnect_I.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2022-07-12-AMA_AADConnect_I.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Azure Meetup Stuttgart (10.02.2022) - Zero trust identity - minor but powerful functionalities in Azure AD</title><link href="http://localhost:4000/2022-02-10-Azure-MeetupStuttgart/" rel="alternate" type="text/html" title="Azure Meetup Stuttgart (10.02.2022) - Zero trust identity - minor but powerful functionalities in Azure AD" /><published>2022-02-10T10:00:32+01:00</published><updated>2022-06-29T11:28:43+02:00</updated><id>http://localhost:4000/Azure-MeetupStuttgart</id><content type="html" xml:base="http://localhost:4000/2022-02-10-Azure-MeetupStuttgart/"><![CDATA[<figure>
  <img src="/MyPics/2022-02-10-Azure-MeetupStuttgart_2.png" style="width:75%" />
  <figcaption>Figure 1: Azure Meetup Teaser</figcaption>
</figure>

<h2 id="session-powerpoint-material">Session Powerpoint material</h2>

<p>All my demos were running perfect and stable during the session.</p>

<p>Murphy, thanks for that 😀</p>

<p>I have enjoyed the evening and being a speaker at the <a href="https://www.meetup.com/de-DE/Azure-Stuttgart/events/282805130/">Meetup in Stuttgart</a></p>

<p>Please find my slides here: <a href="/MySlides/Meetup_Stuttgart_Zero_Trust_with_Identity.pdf">Session slides</a></p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2022-02-10-Azure-MeetupStuttgart/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2022-02-10-Azure-MeetupStuttgart/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2022-02-10-Azure-MeetupStuttgart/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name>Klaus Bierschenk</name></author><summary type="html"><![CDATA[Figure 1: Azure Meetup Teaser]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2022-02-10-Azure-MeetupStuttgart_2.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2022-02-10-Azure-MeetupStuttgart_2.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Want to switch off ADFS? Looking for some content?</title><link href="http://localhost:4000/2022-01-10-GoodBye-ADFS-Overview/" rel="alternate" type="text/html" title="Want to switch off ADFS? Looking for some content?" /><published>2022-01-10T00:06:32+01:00</published><updated>2023-02-26T13:20:26+01:00</updated><id>http://localhost:4000/GoodBye-ADFS-Overview</id><content type="html" xml:base="http://localhost:4000/2022-01-10-GoodBye-ADFS-Overview/"><![CDATA[<figure>
  <img src="/MyPics/2022-01-09-GoodBye-ADFS-Linklist_I.png" style="width:75%" />
  <figcaption>Figure 1: Federation Services Splash Screen</figcaption>
</figure>

<p>Don’t get me wrong, ADFS is great. But it is also a technology with a long history and can (in some cases) be replaced by a better and easier technology in our modern Azure AD World.</p>

<p>But where to start when you have a bunch of applications relying in ADFS?</p>

<p>Or when you might have a relying party to M365 with your federated Azure AD Domain?</p>

<p>Then there are a couple of activities waiting for you …</p>

<p>I attended some sessions last year on shutting down ADFS, and in migrating Relying Party Trusts from ADFS to Azure AD Enterprise Applications, for enduser SSO experiences. From those events and talks I got my own short archive with a list of articles and videos from Microsoft which covers related topics.</p>

<p>In some cases it can make sense to get rid of the ADFS deployment and use PTA or PHS instead and also to move your relying party trusts to Azure AD Enterprise Applications. With this approach you can use the entire stack of Zero Trust features whilst accessing your applications. Conditional access e.g.</p>

<p>Therefore it is a good time to start with migration considerations … if not done already</p>

<table>
  <thead>
    <tr>
      <th>Description</th>
      <th>Link/Reference</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Upgrade from Active Directory Federation Services (AD FS)</td>
      <td><a href="https://www.microsoft.com/en-us/security/business/identity-access-management/upgrade-adfs" target="_blank">Show Article</a></td>
      <td>Overview of the entire situation! Start reading here when you plan to upgrade from ADFS to Azure AD. Contains comparison between ADFS and Azure AD Features</td>
    </tr>
    <tr>
      <td>Migrate from federation to PHS or PTA</td>
      <td><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/migrate-from-federation-to-cloud-authentication" target="_blank">Show Article</a></td>
      <td>Good article with lots of considerations in planning and required pre-work on the entire migration process flow. Also covers step-by-step guidance for implementation. Provides links to more additional articles for topics which are not covered</td>
    </tr>
    <tr>
      <td>Migrate application authentication to Azure Active Directory</td>
      <td><a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/migrate-application-authentication-to-azure-active-directory" target="_blank">Show Article</a></td>
      <td>Bring time to read this one (30min read). Sophisticated article with details reagarding application migration from ADFS to Azure AD</td>
    </tr>
    <tr>
      <td>ADFS Activity Report</td>
      <td><a href="https://aka.ms/migrateapps/ADFSactivity" target="_blank">Show Article</a></td>
      <td>Explains how a ADFS activity report can be created to discover AD FS applications that can be migrated (or not). Covers additional claim rule support aswell</td>
    </tr>
    <tr>
      <td>Videos with topics to upgrade your apps authentication from ADFS to Azure AD</td>
      <td><a href="http://aka.ms/upgradeadfstoaad" target="_blank">Get Videos</a></td>
      <td>Short Videos on YouTube (5-7 min each) from MS Security</td>
    </tr>
    <tr>
      <td>Resources for migrating applications to Azure Active Directory</td>
      <td><a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/migration-resources" target="_blank">Show Article</a></td>
      <td>Links with resources for migration (deployment plan etc.)</td>
    </tr>
    <tr>
      <td>ADFS to AAD App Migration tool</td>
      <td><a href="https://aka.ms/migrateapps/ADFStools" target="_blank">Open Github</a></td>
      <td>Powershell based tools box with cmdlets to collect and analyze ADFS apps. Includes Excel export and cmdlets for migration</td>
    </tr>
  </tbody>
</table>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2022-01-10-GoodBye-ADFS-Overview/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2022-01-10-GoodBye-ADFS-Overview/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2022-01-10-GoodBye-ADFS-Overview/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[summary of ADFS decommissioning aspects]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2022-01-09-GoodBye-ADFS-Linklist_Cover.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2022-01-09-GoodBye-ADFS-Linklist_Cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Cloud Identity Summit ´21 Conference session</title><link href="http://localhost:4000/2021-09-10-CloudIdentitySummit_21/" rel="alternate" type="text/html" title="Cloud Identity Summit ´21 Conference session" /><published>2021-09-10T21:13:32+02:00</published><updated>2022-06-29T11:28:43+02:00</updated><id>http://localhost:4000/CloudIdentitySummit_21</id><content type="html" xml:base="http://localhost:4000/2021-09-10-CloudIdentitySummit_21/"><![CDATA[<figure>
  <img src="/MyPics/2021-09-30-CloudIdentitySummit_21.png" style="width:75%" />
  <figcaption>Figure 1: Cloud Identity Summit '21 Teaser</figcaption>
</figure>

<h2 id="session-from-the-cloud-identity-summit-21">Session from the Cloud Identity Summit ´21</h2>

<p>This was my second appearence at the Cloud Identity Summit and I am proud to return to the line of other great speakers.</p>

<p>All my demos were running “perfectly” and “stable” during my session.</p>

<p>Murphy and demo-god, thanks for that 😀</p>

<p>I have enjoyed the evening and being part of the <a href="https://www.identitysummit.cloud">Cloud Identity Summit ´21</a></p>

<p>Please find my slides here: <a href="/MySlides/TroubleShoot_Sync_EN_Final.pdf">Session slides</a></p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-09-10-CloudIdentitySummit_21/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-09-10-CloudIdentitySummit_21/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-09-10-CloudIdentitySummit_21/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[Figure 1: Cloud Identity Summit '21 Teaser]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-09-30-CloudIdentitySummit_21_Cover.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-09-30-CloudIdentitySummit_21_Cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">How to change language in M365 Portal for a synchronized identity</title><link href="http://localhost:4000/2021-07-04-ChangeLanguageinM365Portal/" rel="alternate" type="text/html" title="How to change language in M365 Portal for a synchronized identity" /><published>2021-07-04T00:01:32+02:00</published><updated>2023-02-26T13:20:26+01:00</updated><id>http://localhost:4000/ChangeLanguageinM365Portal</id><content type="html" xml:base="http://localhost:4000/2021-07-04-ChangeLanguageinM365Portal/"><![CDATA[<figure>
  <img src="/MyPics/2021-06-23-ChangeLanguageinM365Portal_cover.png" style="width:60%" />
</figure>

<h2 id="puzzling-why-language-can-not-be-changed-in-m365-portal-for-synced-users">Puzzling why language can not be changed in M365 Portal for synced users?</h2>

<p>Changing the language in the Azure portal instead is quite simple. Just click on the gear icon in the upper right corner and then on the language item, change it, save and you’re done. And the whole thing in the Azure Portal is independent of whether you are currently working with a cloud-only identity or with a synchronized account. So far so good 😃</p>

<p>However, there is one issue in my daily life that I have been wondering about and putting off for quite some time. Whenever I work with a synchronized account in the M365 Admin portal and try to change the language there, the following message is shown:</p>

<p>if the language is in German</p>

<figure>
  <img src="/MyPics/2021-06-23-ChangeLanguageinM365Portal_II.png" style="width:75%" />
  <figcaption>Figure 1: Language Setting in German</figcaption>
</figure>

<p>and when you have set it already in English language</p>

<figure>
  <img src="/MyPics/2021-06-23-ChangeLanguageinM365Portal_IV.png" style="width:75%" />
  <figcaption>Figure 2: Language setting in English</figcaption>
</figure>

<p>Now the whole thing becomes clumsy at last when you are the administrator yourself, as in my case. In my daily work the language was German, it was ok and the whole thing does not belong to my main issues. But whenever I try to change the language, I wonder at which central place this setting has to be made? On the myaccount.microsoft.com page? Or in some other place in the M365 portal?</p>

<p>This week I didn’t have the topic with the language in the M365 portal present at all and I was in completely different topics in the Active Directory and with the attributes. But after looking through the list of attributes, I noticed the <strong>preferredLanguage</strong> attribute</p>

<figure>
  <img src="/MyPics/2021-06-23-ChangeLanguageinM365Portal_III.png" style="width:50%" />
  <figcaption>Figure 3: Use Attribute "preferredLanguage" to set requested language</figcaption>
</figure>

<p>I remembered the language in the Microsoft 365 portal and indeed the attribute is used to set the language in Microsoft 365 in the form of the “Language Culture Names”. So <strong>de-DE</strong> stands for German and <strong>en-US</strong> for English - United States etc.. You can find an overview of the codes here:
<a href="https://docs.microsoft.com/en-us/previous-versions/commerce-server/ee825488(v=cs.20)?redirectedfrom=MSDN">Table of Language Culture Names</a></p>

<p>My first thought was, not really consistent from Microsoft to control the language behavior differently in two portals (Azure / M365), at least for synchronized identities. But the language is not changed too often and managing it centrally in on-premises for accounts originating there can make sense. After all, many other settings are also administered there, why not the language as well?</p>

<p>Cover image by Mary Pahlke from Pixabay</p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-07-04-ChangeLanguageinM365Portal/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-07-04-ChangeLanguageinM365Portal/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-07-04-ChangeLanguageinM365Portal/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-06-23-ChangeLanguageinM365Portal_cover.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-06-23-ChangeLanguageinM365Portal_cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Azure Meetup Bonn (10.06.2021) - Azure AD Connect - Schaltzentrale der hybriden Identitätsinfrastruktur (German session)</title><link href="http://localhost:4000/2021-06-11-Azure-MeetupBonn/" rel="alternate" type="text/html" title="Azure Meetup Bonn (10.06.2021) - Azure AD Connect - Schaltzentrale der hybriden Identitätsinfrastruktur (German session)" /><published>2021-06-11T00:01:32+02:00</published><updated>2022-06-29T11:28:43+02:00</updated><id>http://localhost:4000/Azure-MeetupBonn</id><content type="html" xml:base="http://localhost:4000/2021-06-11-Azure-MeetupBonn/"><![CDATA[<figure>
  <img src="/MyPics/2021-06-10-MeetupSplash.png" style="width:50%" />
</figure>

<h2 id="session-powerpoint-material">Session Powerpoint material</h2>

<p>All my demos were running perfect and stable during the session.</p>

<p>Murphy, thanks for that 😀</p>

<p>I have enjoyed the evening and being a speaker at the <a href="https://www.meetup.com/de-DE/Azure-Bonn-Meetup/events/277714201/.">Meetup in Bonn</a></p>

<p>Please find my slides here: <a href="/MySlides/Meetup_10.06.2021.pdf">Session slides</a></p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-06-11-Azure-MeetupBonn/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-06-11-Azure-MeetupBonn/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-06-11-Azure-MeetupBonn/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-06-10-MeetupSplash_cover.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-06-10-MeetupSplash_cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Zero Trust in Azure Identity - Part 5: Simple Monitoring Break Glass Accounts</title><link href="http://localhost:4000/2021-01-22-ZeroTrust-Monitoring/" rel="alternate" type="text/html" title="Zero Trust in Azure Identity - Part 5: Simple Monitoring Break Glass Accounts" /><published>2021-01-22T23:01:32+01:00</published><updated>2023-02-26T19:36:35+01:00</updated><id>http://localhost:4000/ZeroTrust%20Monitoring</id><content type="html" xml:base="http://localhost:4000/2021-01-22-ZeroTrust-Monitoring/"><![CDATA[<ul id="markdown-toc">
  <li><a href="#monitoring-and-dealing-with-critical-user-accounts" id="markdown-toc-monitoring-and-dealing-with-critical-user-accounts">Monitoring and Dealing with critical user accounts</a></li>
  <li><a href="#keep-ad-logs-perfectly" id="markdown-toc-keep-ad-logs-perfectly">Keep AD logs perfectly</a></li>
  <li><a href="#automated-alerts" id="markdown-toc-automated-alerts">Automated alerts</a></li>
  <li><a href="#be-careful-with-access-reviews" id="markdown-toc-be-careful-with-access-reviews">Be careful with Access Reviews</a></li>
</ul>

<h2 id="monitoring-and-dealing-with-critical-user-accounts">Monitoring and Dealing with critical user accounts</h2>

<p>Microsoft recommends so-called Break Glass accounts for emergency access. These have maximum permissions and are exempt from security measures such as “Conditional Access” policies. If something goes wrong with any policy or with the connection to on-premises, it is possible to access the tenant with these unaffected Break Glass accounts. In the first part of this post, we looked at more details about Break Glass accounts.
However, it is not only important to be prepared for an emergency. It is equally important to monitor activities around these accounts. For simplicity, the administrator has created a group with the accounts stored in the “Excludes” in the policies. But what if someone cheats his way into this group with his account? The person could work unhindered with wide rights past all policies and thus represents a high risk. Since all activities are documented in the Azure logs, it is easy based on these logs to react to entries using KQL (Kusto Query Language) queries and, for example, send a mail and an SMS to a sender circle when changes are made to the BGA group. The following is necessary for this.</p>

<h2 id="keep-ad-logs-perfectly">Keep AD logs perfectly</h2>

<p>First of all, a log analytics workspace is needed to which Azure automatically sends the AD logs. This makes sense even without our example with the BGA accounts, since the monitoring and logon logs are kept on a limited basis. For Azure AD P1/P2 license 30 days otherwise 7 days.
The Log Analytics workspace is quickly created in the Azure Portal in the dashboard of the same name. In Azure AD, the workspace is added to the diagnostic settings. Thus, the entries end up in the storage account of the workspace, for which the retention period can be defined as desired. Step-by-step instructions for this can be found in the Azure Docs with the corresponding keyword search.</p>

<h2 id="automated-alerts">Automated alerts</h2>

<p>The alerts view for a Log Analytics workspace lists the alert rules that the administrator has created here over time. If you create a new alert rule, the essential elements are a condition and an action group. Both can be created directly at this point. In the same way, you can also use existing conditions or action groups and reuse them as you wish.
If a new action group is created, it may either contain notifications or actions or both. For a notification as in our example, a message definition is sufficient. To do this, we define both a mail and SMS send type in the group, which justifies a change to a critical group, such as the group containing BGA accounts. Note that action groups can be used in a variety of ways, including triggering a webhook or starting an automation runbook.
The second part in the warning rule, the condition, is essentially based on a KQL query that can bring to light from the workspace anything stored in the logs there. Besides our area, the “audit log”, which we need to specify as the source here, there are other areas in a Log Analytics workspace. This ultimately depends on what data sources are connected to the Log Analytics.
Regardless of the alert rules, you can reach the KQL Editor in the Log Analytics workspace via the “Logs” option. Here, several examples are waiting to be tried out and modified for your own purposes. The whole thing invites you to try it out and it is not critical either. KQL queries are the foundation for warnings and the administrative expertise required for this wants to be learned through trial and error.</p>

<p>Back to our warning rule: figure (KQL group change.png) shows the basic statement and the KQL editor with the explorer.</p>

<figure class="medium">
  <a href="/MyPics/2021-01-22-ZeroTrust Monitoring_I.png"><img src="/MyPics/2021-01-22-ZeroTrust Monitoring_I.png" /></a>
  <figcaption>Exclude BGAs from CAs. A "must" in CA deployment</figcaption>
</figure>

<p>The statement is stripped down to the bare essentials and could still be drilled down, for example to include a temporal filter. In the lower area of the results you can see which values the result still provides, which are therefore part of the log entry. In addition to the account that the BGA group has changed, the account that has been added to the group is also visible here.
The KQL statement is inserted into the condition and is thus part of the signal logic (Figure: Warning_Rule_Condition_SignalLogic.png). A number greater than 0 in the case means that the KQL statement was found, thus a change to the group has taken place and this in turn entails that as part of the warning rule the condition is met and the mail and SMS are sent. This is the principle of warnings in Log Analytics. It is recommended in the context of Break Glass accounts to also generate a warning when a BGA account logs in, which can then be acted upon in the manner described. If we assume that all BGA user accounts start with “BG”, so for example the UPN is “BGAx@kbcorp.de” with sequential number x. The KQL statement for this looks like the following:</p>

<div class="language-posh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SigninLogs</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="nx">OperationName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Sign-in activity"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="w"> </span><span class="nx">startswith</span><span class="w"> </span><span class="s2">"BG"</span><span class="o">.</span><span class="w"> 
</span></code></pre></div></div>

<h2 id="be-careful-with-access-reviews">Be careful with Access Reviews</h2>

<p>Actually, access reviews lend themselves to the control of BGA groups, but caution is advised in that context. Access Reviews also always allow members of a group to be removed, be it because an admin on his iPhone, on the go, mistakenly selects “deny”, the BGA accounts fall out of the group and are thus unsuitable for emergency use. Admittedly a contrived example but the possibility exists and with sensitive accounts such as the BGA accounts you should leave nothing to chance and fare far better with the warning rules against Access Reviews in the event of controls on the break Glass accounts.</p>

<p>Cover image by Peggy und Marco Lachmann-Anke from Pixabay</p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-01-22-ZeroTrust-Monitoring/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-01-22-ZeroTrust-Monitoring/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-01-22-ZeroTrust-Monitoring/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[Keep an eye to the most sensitive accounts in your Azure AD]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-01-22-ZeroTrust%20Monitoring_cover.png" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-01-22-ZeroTrust%20Monitoring_cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Zero Trust in Azure Identity - Part 4: Access Reviews</title><link href="http://localhost:4000/2021-01-19-ZeroTrust-AR/" rel="alternate" type="text/html" title="Zero Trust in Azure Identity - Part 4: Access Reviews" /><published>2021-01-19T14:22:32+01:00</published><updated>2023-02-26T13:20:26+01:00</updated><id>http://localhost:4000/ZeroTrust%20AR</id><content type="html" xml:base="http://localhost:4000/2021-01-19-ZeroTrust-AR/"><![CDATA[<ul id="markdown-toc">
  <li><a href="#goodbye-forgotten-group-memberships" id="markdown-toc-goodbye-forgotten-group-memberships">Goodbye forgotten group memberships</a></li>
  <li><a href="#access-review-using-an-example" id="markdown-toc-access-review-using-an-example">Access Review using an example</a></li>
  <li><a href="#fine-tuning-for-access-control" id="markdown-toc-fine-tuning-for-access-control">Fine tuning for access control</a></li>
  <li><a href="#access-reviews-vs-dynamic-groups" id="markdown-toc-access-reviews-vs-dynamic-groups">Access Reviews vs. Dynamic Groups</a></li>
</ul>

<h2 id="goodbye-forgotten-group-memberships">Goodbye forgotten group memberships</h2>

<p>Who hasn’t had this happen to them? A user account is added to a group and then you forget to remove the member? Unfortunate if the group is a security-sensitive group or role, and there are quite a few of those in Azure. One remedy for this is the “Access Reviews”, or access checks, in German portal language. Access reviews are a means of putting groups, roles or enterprise applications to the test and validating the members assigned or contained.
The settings in the Azure AD portal can be found in the objects for which you want to create a check. This means in the area of the groups or enterprise applications. The exception to this are the roles, whose “Access Reviews” are not administered in Azure AD in the roles, but in the PIM Dashboard. Somewhat hidden after selecting the “Manage” option. By the way, do not confuse this with the item “Review Access”, which is located in PIM directly above, under “Tasks”. This is used to process any pending reviews for the user account that is currently navigating in the PIM portal and is stored as a reviewer.</p>

<h2 id="access-review-using-an-example">Access Review using an example</h2>

<p>To explain the options available when reviewing roles, let’s take a look at an example of the settings you may encounter. Let’s say you want to review the members of the Global Reader role on a weekly basis and remove any user accounts you no longer need that you know should not be members there. To do this, we navigate to the “Manage” section in the PIM Dashboard and select the “Azure AD Roles” option, from where we go directly to the access checks. Many of the setting options are self-explanatory, such as the name or even the start date. One of the elementary options here is the time frame, notably the “Duration (in days)” option. This defines the period for which an “Access Review” is available and reviewers can make entries. The number of days possible here again depends on whether and which “Frequency” is selected, as the duration must not be longer than the number of days in the selected period, otherwise time overlaps will occur during the reviews. For our example, we select the weekly interval and 1 day for the duration. You can specify more than one role, but for our example we will limit ourselves to the role “Global Reader”.
Further down in the dialog you specify the already mentioned reviewers. If there are several decision makers in your department, it may make sense to specify all of them here. If one of them starts the check, the list will later show for which user accounts the membership was approved or denied and also who decided this.</p>

<h2 id="fine-tuning-for-access-control">Fine tuning for access control</h2>

<p>At the very bottom of the dialog there is still the possibility of “fine tuning” via some advanced settings. Here you can specify whether accounts are actually removed or not. If no, this is only logged, which is useful for a test phase, for example. Especially worth mentioning at this point is the possibility to define what should happen if the reviewer(s) do not react. “No changes”, “Remove access”, “Approve access” or “Follow recommendations”. In the case of the latter, the system decides on the continued existence of the membership. For example, has a user not logged in for a period of 30 days? In that case, the role membership would be removed. Also hidden, but possibly very useful, is the possibility to select “Members (self)” in the checker. As the name already conveys, no other persons are requested to check, but the members themselves. This kind of check is basically a “knot in the handkerchief” that the administrator makes himself here to be reminded of the membership. An administratively probably rather rare scenario, but if the admin wants it, the option can certainly provide valuable services.</p>

<h2 id="access-reviews-vs-dynamic-groups">Access Reviews vs. Dynamic Groups</h2>

<p>When using access reviews for Azure AD groups, it is worth mentioning the possibility of dynamic groups, which permanently fill the security groups with members based on query rules. This can replace access checks and may be a more elegant way to deal with members, as the admin does not have to worry about anything else with a well-defined query. Of course, this only applies to groups where dynamic membership is appropriate and not to roles and enterprise applications, as there is no dynamic assignment here. Here, it is important to plan well and make an approach for access reviews or a dynamic group in advance.
Access reviews also show up in various other places in Azure AD, such as access packages. The methodology behind this is always the same and analogous to that described here.</p>

<p>Cover image Mohamed Hassan from Pixabay</p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-01-19-ZeroTrust-AR/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-01-19-ZeroTrust-AR/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-01-19-ZeroTrust-AR/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[Automatic membership reminder]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-01-19-ZeroTrust_AR_cover.jpg" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-01-19-ZeroTrust_AR_cover.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Zero Trust in Azure Identity - Part 3: Conditional Access</title><link href="http://localhost:4000/2021-01-18-ZeroTrust-CA/" rel="alternate" type="text/html" title="Zero Trust in Azure Identity - Part 3: Conditional Access" /><published>2021-01-18T20:01:57+01:00</published><updated>2023-02-26T13:20:26+01:00</updated><id>http://localhost:4000/ZeroTrust%20CA</id><content type="html" xml:base="http://localhost:4000/2021-01-18-ZeroTrust-CA/"><![CDATA[<ul id="markdown-toc">
  <li><a href="#conditional-access-example" id="markdown-toc-conditional-access-example">Conditional access example</a></li>
  <li><a href="#policy-parameters" id="markdown-toc-policy-parameters">Policy parameters</a></li>
  <li><a href="#test-before-deploy" id="markdown-toc-test-before-deploy">Test before deploy</a></li>
</ul>

<p>Conditional access policies are a perfect tool for best adapting logon and access to specific applications to the diverse circumstances of users. They are suitable for aggregating signals, making decisions based on them, and enforcing organizational policies. The user context is crucial for this and after evaluating the policy, access is allowed, blocked or certain criteria must be met in order for the user to reach their destination.</p>

<p>Unlike what you may be used to in other policies, the design of CA policies is very complex and the administrator determines the level of complexity. It starts with a string of if statements that evaluate signals mentioned earlier. These can be simple group memberships of the user up to the combination of device platforms(iOS, Windows) or a location from which the user started his access attempt.
In the editor, the target for the policy is defined in the “Assignments” section. In the “Access controls” section, it is possible to describe what should happen in a positive or negative sense. It is also possible to evaluate signals from other areas of the Azure platform here, for example, the logon risk from Identity Protection can be included in the conditions. If the user’s access represents a medium or high logon risk, access to sensitive applications may no longer be permitted or only by using MFA.</p>

<h2 id="conditional-access-example">Conditional access example</h2>

<p>Let’s look at an example to illustrate the power of the policy. Let’s say you want to allow access to Azure Portal for administrators only when they are accessing from the corporate location and when the machine being used is a hybrid device mounted in Azure AD.
Navigate to the conditional access policies section. You can find the CA policies in the Azure Active directory dashboard and there in the “Manage” and “Security” section.
If you want to make it quick, you can also search for “Conditional Access” in the resources search box at the top of the Azure portal and you’ll get right to it. You may well have Baseline Policies in your policy list, which are a legacy feature from the early days of policies. Make sure that these are not activated, they will be removed from the portal “soon”.
Below that, all defined policies are displayed, with an indication if they are active. Here it becomes quickly apparent that especially with the configuration variety an overview of the contents of the policies is desirable. Who wants to open each policy to see what its purpose is. For this purpose, a well thought-out naming concept is helpful, with which you can recognize the purpose in the list on the basis of the names. Microsoft has some design recommendations ready, among other things how the name concept can look like, so that you can keep the overview (https://docs.microsoft.com/de-de/azure/active-directory/conditional-access/plan-conditional-access).
Since we are referring to familiar sites with our policy, they must exist. Named locations can be edited in the editor in the administration area on the left. No matter if locations are used within the guidelines, it is recommended to store due subnets of the known location. This way you always have everything ready for all cases.</p>

<h2 id="policy-parameters">Policy parameters</h2>

<p>In our example the policy is named: “<strong>CA03-AzurePortal: Block for all Security Roles when Admin not On-Prem AND hybrid Client</strong>”.
Which actually says everything without the administrator having to look at the policy. Creating the policy is self-explanatory in the editor. In the assignments we leave users and groups blank and select all the roles we want for the scenario, “Global Administrator”, “Security Administrator”, etc. At this point it is especially important that in the “Exclude” tab of the users and groups we leave the Break Glass accounts mentioned above, as these must be excluded. Next, we go to “Cloud apps …” and select Azure Portal from the list of registered apps. For the conditions, we focus on the sites and here it is important to select “All sites” under “Include” and for “Exclude” we select “All trusted sites”. Since our policy denies access, we exclude trusted location from the policy. The policy can be further refined and in the conditions these can be extended with the criterion device status and “hybrid device”.</p>

<figure>
  <img src="/MyPics/2021-01-18-ZeroTrust CA_I.png" style="width:100%" />
  <figcaption>Example of a location based Conditional Access Policy</figcaption>
</figure>

<h2 id="test-before-deploy">Test before deploy</h2>

<p>Not every administrator has a test environment ready to test the impact of the policies. Or often the labs are not as close to production to develop the policies there. Since working on policies is open-heart surgery in production, there are some tools to help with the startup. For example, when activating the policy, the “Report Only” option is useful. This means that the policy does nothing more than write an entry in the login log. So the policy is armed in production, but does not do anything except the log entry.</p>

<figure>
  <img src="/MyPics/2021-01-18-ZeroTrust CA_III.png" style="width:100%" />
  <figcaption>Sign-in logs help investigate what happened regarding CA</figcaption>
</figure>

<p>Furthermore the function “What If” should be pointed out. Here you have the possibility to simulate a login or an access. In a list the applied policies and their result are shown.</p>

<figure>
  <img src="/MyPics/2021-01-18-ZeroTrust CA_II.png" style="width:100%" />
  <figcaption>Sign-in logs help investigate what happened regarding CA</figcaption>
</figure>

<p>These tools help to avoid that the administrator locks out. If this should happen nevertheless times, there is the possibility to log in with a Break Glass account, provided it is deposited with the guidelines in the “Excludes”.</p>

<figure>
  <img src="/MyPics/2021-01-18-ZeroTrust CA_IV.png" style="width:70%" />
  <figcaption>Exclude BGAs from CAs. A "must" in CA deployment</figcaption>
</figure>

<p>Cover image by Gerd Altmann from Pixabay</p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-01-18-ZeroTrust-CA/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-01-18-ZeroTrust-CA/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-01-18-ZeroTrust-CA/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[CA - the center of Zero Trust with Identity]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-01-18-ZeroTrust%20CA_cover.jpg" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-01-18-ZeroTrust%20CA_cover.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Zero Trust in Azure Identity - Part 2: MFA! Is there a right way?</title><link href="http://localhost:4000/2021-01-16-ZeroTrust-MFA/" rel="alternate" type="text/html" title="Zero Trust in Azure Identity - Part 2: MFA! Is there a right way?" /><published>2021-01-16T15:59:57+01:00</published><updated>2023-02-26T13:20:26+01:00</updated><id>http://localhost:4000/ZeroTrust%20MFA</id><content type="html" xml:base="http://localhost:4000/2021-01-16-ZeroTrust-MFA/"><![CDATA[<ul id="markdown-toc">
  <li><a href="#is-there-a-right-way-to-implement-mfa" id="markdown-toc-is-there-a-right-way-to-implement-mfa">Is there a right way to implement MFA</a></li>
  <li><a href="#good-planning-is-important" id="markdown-toc-good-planning-is-important">Good planning is important</a></li>
  <li><a href="#exploit-the-possibilities" id="markdown-toc-exploit-the-possibilities">Exploit the possibilities</a></li>
</ul>

<h2 id="is-there-a-right-way-to-implement-mfa">Is there a right way to implement MFA</h2>

<p>MFA has become more prevalent with many providers on the Internet. This definitely also includes the Microsoft world and the logon to Azure AD or Microsoft 365. The distribution of MFA, or switching on when which user has to log on with a second factor in Azure AD, is linked to powerful policies. The topic as a whole has a multi-layered structure, and this is especially true for licensing, i.e. costs, in addition to the options for deployment. Here, unfortunately, as with other Azure features, the cost and capabilities depend on which Azure AD plan they are using. For example, the ability to use SMS as a second factor is not available in all editions. A good overview of all tariffs with the corresponding functionalities can be found in the following Microsoft Docs <a href="https://docs.microsoft.com/de-de/azure/active-directory/authentication/concept-mfa-licensing" target="_blank">article</a>. At this point we are looking at the technology, primarily the provision of MFA.</p>

<h2 id="good-planning-is-important">Good planning is important</h2>

<p>The easiest way to get MFA to users is to do it statically. This no “ifs” and “buts” method can be found somewhat hidden in the Azure AD Portal, in the display of all users in the command bar at the top. This method also requires you to specify a CSV file as the source with the contents of the desired user accounts. You should think twice about this but rather antiquated method. In today’s dynamic times, a rather smart method of distributing MFA is required, preferably if this can be tied to conditions. And there you have several options at hand. The most common, and the one recommended by Microsoft, is to enable it via “Conditional Access Policies”. They offer more options than controlling the distribution of MFA. CA is only one part of it, but more on that later.</p>

<h2 id="exploit-the-possibilities">Exploit the possibilities</h2>

<p>If you have Identity Protection in place, you can define MFA as part of the logon risk policy. If a user logon risk is detected, you can react in several ways, one of them is to allow logon using MFA.
A typical lab case is, for example, a logon using the TOR browser, which hides the actual IP address, or when a logon is made from two different geographical locations, which is also atypical in normal cases. However, it is always possible that this is legitimate, for example when a developer is testing something, so the logon can be granted via MFA. Identity Protection can also be used to roll out MFA to all users by enabling the MFA registration policy in the Identity Protection Dashboard. Unlike the manual approach mentioned above, here it is possible to specify AD groups, which allows us to make the activation selective for specific users.</p>

<p>Cover image by Gerd Altmann from Pixabay</p>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

<div class="share-box">
<h5>Share this:</h5>

<a class="t" href="https://twitter.com/intent/tweet?text=&amp;url=http://localhost:4000/2021-01-16-ZeroTrust-MFA/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter fa"></i><span> twitter</span></a>

<a class="l" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2021-01-16-ZeroTrust-MFA/&amp;title=&amp;summary=&amp;source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin fa"></i><span> linkedin</span></a>

<a class="e" href="mailto:?subject=&amp;body=Check out this site http://localhost:4000/2021-01-16-ZeroTrust-MFA/"><i class="fa fa-envelope fa"></i><span> email</span></a>                          
</div>]]></content><author><name></name></author><summary type="html"><![CDATA[MFA - 2 min considerations]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/MyPics/2021-01-18-ZeroTrust_MFA_cover.jpg" /><media:content medium="image" url="http://localhost:4000/MyPics/2021-01-18-ZeroTrust_MFA_cover.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>